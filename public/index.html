<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deprem Görselleştirme Uygulaması</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
    <link rel="stylesheet" href="https://unpkg.com/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.css" />

    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header class="bg-dark text-white text-center py-2">
        <h5>Deprem Analiz ve Görselleştirme Uygulaması</h5>
    </header>

    <div class="d-flex" id="main-container">

        <!-- Map Section -->
        <main id="map-container" class="flex-grow-1 position-relative">
            <div id="map" class="w-100 h-100"></div>
            <div id="layerSwitcherContainer"></div>

            <div id="ol-popup" class="ol-popup">
                <a href="#" id="ol-popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>

            <!-- Sidebar -->
            <aside id="sidebar" class="bg-light border-end p-3">
                <h6>Filtreleme</h6>

                <form id="filterForm">

                    <div class="mb-2">
                        <label class="form-label">Tarih Aralığı *</label>
                        <input type="date" class="form-control mb-1" id="start" value="2023-02-05" />
                        <input type="date" class="form-control" id="end" value="2023-02-07" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Büyüklük Aralığı</label>
                        <input type="number" step="0.1" class="form-control mb-1" id="minmag" placeholder="Min" />
                        <input type="number" step="0.1" class="form-control" id="maxmag" placeholder="Max" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Derinlik Aralığı (km)</label>
                        <input type="number" class="form-control mb-1" id="mindepth" placeholder="Min" />
                        <input type="number" class="form-control" id="maxdepth" placeholder="Max" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Koordinat Aralığı: </label>
                        <input type="number" step="0.001" class="form-control mb-1" id="minlat" placeholder="Min Lat"
                            style="display: true;" />
                        <input type="number" step="0.001" class="form-control mb-1" id="maxlat" placeholder="Max Lat"
                            style="display: true;" />
                        <input type="number" step="0.001" class="form-control mb-1" id="minlon" placeholder="Min Lon"
                            style="display: true;" />
                        <input type="number" step="0.001" class="form-control mb-1" id="maxlon" placeholder="Max Lon"
                            style="display: true;" />
                        <button type="button" id="drawBoxBtn"
                            class="btn btn-sm btn-outline-secondary mt-2 mb-2">Haritada Alan Seç</button>
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Limit:</label>
                        <input type="number" id="limit" class="form-control mb-1" placeholder="Veri limitini giriniz">
                    </div>

                    <button id="fetchBtn" type="button" class="btn btn-secondary w-100 mt-2">Verileri Getir</button>
                </form>

                <hr />

                <div id="stats">
                    <h6>Deprem Sayısı: <span id="eqCount"></span></h6>
                    <h6>En Büyük Deprem:</h6>
                    <div class="text-center">
                        <p><span id="maxEq"></span></p>
                        <p>Tarih: <span id="maxEqDate"></span></p>
                        <p>Büyüklük: <span id="maxEqMag"></span></p>
                        <p>Derinlik: <span id="maxEqDep"></span></p>
                    </div>
                </div>

                <hr />

                <pre id="output">Henüz veri yok...</pre>
            </aside>

            <div class="cityFilterAnalysisDiv">
                <label class="form-label">Şehir Bazında Filtrele</label>
                <select id="citySelect" class="form-select">
                    <option value="">Bir Şehir Seç</option>
                </select>
                <button id="cityFilterAnalysisBtn" type="button" class="btn btn-secondary w-100 mt-2">Analizi Başlat</button><br>
                <button id="togglePanel" type="button" class="btn btn-secondary w-100 mt-2">Analiz Sonuçları</button>
            </div>

            <div class="pointsAnalysisDiv">
                <label class="form-label">Nokta Ekleyip Analiz Et</label>
                <button id="addPointBtn" type="button" class="btn btn-secondary w-100 mt-2">Nokta Ekle</button>
                <button id="closePointBtn" type="button" class="btn btn-secondary w-100 mt-2">Nokta eklemeyi durdur</button>
                <button id="pointAnalysisBtn" type="button" class="btn btn-secondary w-100 mt-2">Analiz Et</button>
                <button id="showAnalysisBtn" type="button" class="btn btn-secondary w-100 mt-2">Analiz Sonuçları</button>
            </div>

            <div id="pointNameModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Nokta Adı</h3>
                    <input type="text" id="pointNameInput" class="form-control" placeholder="Nokta ismini giriniz" />
                    <div class="modal-actions">
                        <button id="confirmPointName" class="btn btn-secondary">Onayla</button>
                        <button id="cancelPointName" class="btn btn-secondary">İptal</button>
                    </div>
                </div>
            </div>

            <div id="infoPanel" >
                <h6 class="bg-dark text-white text-center py-3">Analiz Sonuçları <a href="#" id="closePanel" class="closePanel"></a></h6>

                <div id="pointsContainer"></div>
                <div id="chartsSection" class="charts-section">
                
                    <div class="chart-card m-3">
                        <h5>VS30 Değerleri (m/s)</h5>
                        <canvas id="vs30Chart"></canvas>
                    </div>
                
                    <div class="chart-card m-3">
                        <h5>Sismik Tehlike PGA(g)475 v2023.1</h5>
                        <canvas id="pgaChart"></canvas>
                    </div>
                
                    <div class="chart-card m-3">
                        <h5>Tehlike İndeksi</h5>
                        <canvas id="hazardChart"></canvas>
                    </div>
                
                </div>

            </div>

        </main>

        <div id="legendContainer">
            <div id="legend-il" class="legend" style="display:block">
                <div class="legend-title">İl Sınırları</div>
                <div class="legend-bar il"></div>
            </div>
            <div id="legend-fay" class="legend" style="display:block">
                <div class="legend-title">Diri Faylar</div>
                <div class="legend-bar fay"></div>
            </div>
            <div id="legend-pga" class="legend" style="display:none">
                <div class="legend-title">Sismik Tehlike PGA(g)475 v2023.1</div>
                <div class="legend-bar pga"></div>
                <div class="legend-labels">
                    <span></span>
                    <span>0.1</span>
                    <span>0.2</span>
                    <span>0.3</span>
                    <span>0.4</span>
                    <span>0.5</span>
                    <span></span>
                </div>
            </div>
            <div id="legend-danger" class="legend" style="display:none">
                <div class="legend-title">Deprem Tehlike İndeksi</div>
                <div class="legend-bar danger"></div>
                <div class="legend-labels">
                    <span></span>
                    <span>0.2</span>
                    <span>0.4</span>
                    <span>0.6</span>
                    <span>0.8</span>
                    <span></span>
                </div>
            </div>
            <div id="legend-vs30" class="legend" style="display:none">
                <div class="legend-title">Vs30 (m/s)</div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #b10026"></span>
                    <span>≤ 180</span>
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #fd8d3c"></span>
                    <span>180-240</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #feb24c"></span>
                    <span>240-300</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #ffeda0"></span>
                    <span>300-360</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #addd8e"></span>
                    <span>360-490</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #78c679"></span>
                    <span>490-600</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #41ab5d"></span>
                    <span>600-760</span>  
                </div>
                <div class="legend-labels vs30">
                    <span class="legend-label-color" style="background: #004529"></span>
                    <span>≥ 760</span>  
                </div>
            </div>
            <div id="legend-eq" class="legend" style="display:none">
                <div class="legend-title">Deprem Büyüklüğü</div>

                <div class="legend-row">
                    <span class="legend-dot mag8"></span>
                    <span>≥ 8.0</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag7"></span>
                    <span>7.0 – 7.9</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag6"></span>
                    <span>6.0 – 6.9</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag5"></span>
                    <span>5.0 – 5.9</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag4"></span>
                    <span>4.0 – 4.9</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag3"></span>
                    <span>3.0 – 3.9</span>
                </div>
                <div class="legend-row">
                    <span class="legend-dot mag2"></span>
                    <span>&lt; 3.0</span>
                </div>
            </div>
            <div id="legend-heatmap" class="legend" style="display:none;">
                <div class="legend-title">Deprem Isı Haritası</div>

                <div class="legend-bar heatmap"></div>

                <div class="legend-labels">
                    <span>Düşük</span>
                    <span>Yüksek</span>
                </div>
            
                <div class="legend-heatmap-note">
                    Yoğunluk, deprem büyüklüğü ile ağırlıklandırılmıştır.
                </div>
            </div>

        </div>

        <div id="statsPanel" class="statsPanel hidden">
            <a href="#" id="statsPanel-closer" class="statsPanel-closer"></a>
            <h5 class="text-center mb-2">Analiz Sonuçları</h5>
            <div id="basicStats" class="p-2 small"></div>

            <canvas id="mainChart" height="140"></canvas><br>
            <canvas id="magChart" height="140"></canvas><br>
            <!-- <canvas id="depthChart" height="140"></canvas> -->
            
            <h6 class="mt-2 mb-3">Deprem Listesi</h6>
            <table class="table table-sm table-striped" id="eqTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tarih</th>
                        <th>İlçe</th>
                        <th>Büyüklük</th>
                        <th>Derinlik</th>
                        <th>RMS</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-2">
        Kaynak: AFAD API
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
    <script src="https://unpkg.com/ol-layerswitcher@4.1.2"></script>
    <script src="https://unpkg.com/shpjs@3.6.2/dist/shp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>

    <script src="./js/app.js" type="module"></script>
</body>

</html>